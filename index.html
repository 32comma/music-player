<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #audio-container {
            color: white;
            margin: 1rem;
        }

        #canvas {
            position: absolute;
            left: 0;
            top: 8rem;
        }
    </style>
</head>

<body>
    <div id="audio-container">
        <audio id="audio" src="" controls autoplay onended="next()"></audio>
        <div id="name"></div>
        <button onclick="prev()">&lt;&lt;</button>
        <button onclick="next()">&gt;&gt;</button>
        <canvas id="canvas" width="1000" height="50">
    </div>
    <script>
        const WIDTH = 1000;
        const HEIGHT = 50;
        var canvas = document.getElementById('canvas');
        var canvasCtx = canvas.getContext('2d');
        var context = new AudioContext();
        var audio = document.getElementById('audio');
        var source = context.createMediaElementSource(audio);
        var analyser = context.createAnalyser();
        source.connect(analyser);
        source.connect(context.destination);
        analyser.fftSize = 4096;
        var bufferLength = analyser.frequencyBinCount;
        var dataArray = new Uint8Array(bufferLength);
        analyser.getByteTimeDomainData(dataArray);
        function draw() {
            drawVisual = requestAnimationFrame(draw);

            analyser.getByteFrequencyData(dataArray);
            canvasCtx.fillStyle = 'rgb(255, 255, 255,0)';
            canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);
            var barWidth = (WIDTH / bufferLength) * 2.5;
            var barHeight;
            var x = 0;
            for (var i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i] / 2;
                canvasCtx.fillStyle = 'rgba(255,0,0,1)';
                canvasCtx.fillRect(x, HEIGHT - barHeight / 2, barWidth, barHeight);
                x += barWidth + 1;
                setTimeout(function(){
                    canvasCtx.clearRect(0,0,WIDTH,HEIGHT);
                },100);
            }
        };
        draw();
    </script>
    <script>
        var list = [
            'study.wav', 'wave.wav', 'why.wav'
        ];
        var idx = 0;
        function setAudio(v) {
            var audio = document.getElementById('audio');;
            var name = document.getElementById('name');
            name.innerHTML = v;
            audio.src = list[idx];
        }
        function next() {
            idx++;
            if (idx >= list.length) {
                idx = 0;
            }
            console.log(idx);
            setAudio(list[idx]);
        }
        function prev() {
            idx--;
            if (idx < 0) {
                idx = list.length - 1;
            }
            console.log(idx);
            setAudio(list[idx]);
        }
        setAudio(list[idx]);
    </script>

</body>

</html>